var mhmli_googlemaps_rootclass,MarkerWithLabel,marker,bounds,mhmli_googlemaps,google,customStyle;!function($){mhmli_googlemaps={map:null,mapContainer:null,infowindow:null,infowindowContent:null,locations:[],pins:[],map_clustered:null,text:{reset:"Reset",close:"Close"},asset_path:"",pin_default:function(){return null},useStyledMarkers:!1,options:{cluster:!1,clusterstyles:null,mapTypeID:null,mapTypes:null,lat_default:46.817918,lon_default:8.227386,zoomlevel_start:7,zoomlevel_default:7,zoomlevel_near:10,zoomlevel_minimum:1,focus_centre:!0,showLabels:!1,fitToBounds:!1,hasInfoWindow:!0,focus_zoom:!0,icon_offset:[0,0],icon_size:[16,16],icon:null},controls:{blockUI:!1,resetbutton:!0,visualRefresh:!0,disableDefaultUI:!1,panControl:!1,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,overviewMapControl:!1,zoomControl:!0,zoomControlOptions:{style:null,position:null}},setMapStyle:function(o){if(o&&null!==o){this.options.mapTypes&&this.options.mapTypes.length&&this.options.mapTypes.push(t);var t=new google.maps.StyledMapType(o,{name:"customStyle"});this.map.mapTypes.set("customStyle",t),this.map.setMapTypeId("customStyle")}},Marker:function(o){return marker=o.baseClass.options.showLabels?new MarkerWithLabel({position:o.position,zIndex:o.zIndex,map:o.map,icon:o.icon,labelContent:o.labelContent,markerContent:o.markerContent,labelAnchor:new google.maps.Point(12,8),title:o.title,locationID:o.locationID}):new google.maps.Marker({position:o.position,zIndex:o.zIndex,map:o.map,icon:o.icon,labelContent:o.labelContent,markerContent:o.markerContent,title:o.title,locationID:o.locationID}),marker.baseClass=o.baseClass,marker},makeMap:function(o,t){this.controls.visualRefresh&&(google.maps.visualRefresh=!0),this.mapContainer=$("#"+o);var e={zoom:this.options.zoomlevel_default,center:this.centrePoint(),panControl:this.controls.panControl,mapTypeControl:this.controls.mapTypeControl,scaleControl:this.controls.scaleControl,streetViewControl:this.controls.streetViewControl,overviewMapControl:this.controls.overviewMapControl,zoomControl:this.controls.zoomControl,zoomControlOptions:this.controls.zoomControlOptions};this.options.mapTypes&&this.options.mapTypes.length&&(e.mapTypeControlOptions={mapTypeIds:this.options.mapTypes},e.mapTypeControl=!0),this.options.mapTypeID&&(e.mapTypeId=this.options.mapTypeID),this.controls.disableDefaultUI&&(e.disableDefaultUI=!0),this.controls.blockUI&&(e.draggable=!1,e.zoomable=!1,e.scrollwheel=!1,e.navigationControl=!1,e.mapTypeControl=!1,e.scaleControl=!1,e.draggable=!1),this.map=new google.maps.Map(document.getElementById(o),e),this.map.setZoom(this.options.zoomlevel_start),this.setMapStyle(t),this.options.fitToBounds&&(bounds=new google.maps.LatLngBounds);var n,s,i=this,l=[];for(s in this.locations)if(this.locations.hasOwnProperty(s)){var a=this.locations[s].rankedPosition;if(n=new this.Marker({position:new google.maps.LatLng(this.locations[s].longitude,this.locations[s].latitude),title:this.locations[s].title,labelContent:this.locations[s].labelContent,markerContent:this.locations[s].markerContent,rankedPosition:a+"",zIndex:1e4-s,locationID:this.locations[s].locationID,icon:this.options.icon,baseClass:this}),this.locations[s]&&this.locations[s].icon){var r=this.locations[s].offset?this.locations[s].offset:this.options.icon_offset,p=this.locations[s].icon_size?this.locations[s].icon_size:this.options.icon_size;n.setIcon({url:this.locations[s].icon,anchor:new google.maps.Point(r[0],r[1]),size:new google.maps.Size(p[0],p[1])})}this.options.fitToBounds&&bounds.extend(n.position),google.maps.event.addListener(n,"click",function(o){i.markerClickHandler(o,this,i)}),l.push(n)}if(google.maps.event.addListener(this.map,"zoom_changed",function(){i.map.getZoom()<i.options.zoomlevel_minimum&&i.map.setZoom(i.options.zoomlevel_minimum)}),this.options.cluster){var m=this.options.clusterstyles?{styles:this.options.clusterstyles}:{};this.map_clustered=new MarkerClusterer(this.map,l,m)}else for(var s=0;s<l.length;s++)l[s].setMap(this.map);this.options.fitToBounds&&this.map.fitBounds(bounds),this.addResetButton(),this.monitorEscapeButton()},centrePoint:function(){return new google.maps.LatLng(this.options.lat_default,this.options.lon_default)},resetMap:function(){this.hideOverlay(),this.map.setZoom(this.options.zoomlevel_default),this.map.setCenter(this.centrePoint())},markerClickHandler:function(o,t,e){if(e.options.focus_centre&&e.map.panTo(t.getPosition()),e.options.focus_zoom){var n=e.map.getZoom();n<e.options.zoomlevel_near&&e.map.setZoom(e.options.zoomlevel_near)}e.options.hasInfoWindow&&e.showOverlay(e.map,t)},showOverlay:function(o,t){if(!this.infowindow){this.infowindow=$('<div class="overlay window"><div class="wrapper"><div class="inner"><a class="close button" href="#">'+this.text.close+'</a><div class="content"></div></div></div></div>'),this.infowindowContent=this.infowindow.find("div.content");var e=this;this.infowindow.find("a.close").click(function(o){o.preventDefault(),e.hideOverlay()}),this.mapContainer.append(this.infowindow)}this.fillOverlay(t.markerContent),this.infowindow.show()},fillOverlay:function(o){this.infowindowContent&&this.infowindowContent.html(o)},hideOverlay:function(){this.infowindow&&(this.infowindowContent.empty(),this.infowindow.hide())},addResetButton:function(){this.controls.resetbutton&&(this.resetButton=$('<button class="reset">'+this.text.reset+"</button>"),baseClass=this,this.resetButton.click(function(o){baseClass.resetMap()}),$(this.map.b).append(this.resetButton))},monitorEscapeButton:function(){mhmli_googlemaps_rootclass=this,$(document).keydown(function(o){27===o.keyCode&&mhmli_googlemaps_rootclass.hideOverlay&&mhmli_googlemaps_rootclass.hideOverlay()})}}}(jQuery);